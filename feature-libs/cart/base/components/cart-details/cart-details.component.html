<ng-container *ngIf="cart$ | async as cart">
  <ng-container *ngIf="entries$ | async as entries">
    <div *ngIf="cart.totalItems > 0" class="cart-details-wrapper">
      <ng-container *cxFeatureLevel="'4.2'">
        <cx-cart-validation-warnings></cx-cart-validation-warnings>
      </ng-container>

      <h2 class="cx-total">
        {{ 'cartDetails.cartName' | cxTranslate: { code: cart.code } }}
      </h2>

      <cx-promotions
        [promotions]="
          (cart.appliedOrderPromotions || []).concat(
            cart.potentialOrderPromotions || []
          )
        "
      ></cx-promotions>

      <cx-cart-item-list
        [items]="entries"
        [cartIsLoading]="!(cartLoaded$ | async)"
        [promotionLocation]="promotionLocation"
        [options]="{
          isSaveForLater: false,
          optionalBtn: saveForLaterBtn
        }"
      ></cx-cart-item-list>
    </div>
  </ng-container>
</ng-container>

<ng-container *ngIf="entryGroups$ | async as entryGroups">
  <div *ngFor="let entryGroup of entryGroups">
    {{ entryGroup.entryGroupNumber }}

    <ng-container *ngIf="!entryGroup.allowedProducts">
      <h2>{{ entryGroup.label }}</h2>
      <button (click)="removeBundle(entryGroup.entryGroupNumber)">
        Remove Bundle {{ entryGroup.entryGroupNumber }}
      </button>
      <div *ngFor="let subGroup of entryGroup.entryGroups">
        <h3>{{ subGroup.label }}</h3>
        <button (click)="getBundleAllowedProducts(subGroup.entryGroupNumber)">
          {{
            subGroup.entries.length > 0
              ? subGroup.entries[0].product.name
              : 'Choose Product'
          }}
        </button>
        <button
          *ngIf="subGroup.entries[0].product.name"
          (click)="removeBundle(subGroup.entryGroupNumber)"
        >
          Remove Sub Group {{ subGroup.entryGroupNumber }}
        </button>

        <div
          *ngIf="
            getAvailableProducts(subGroup.entryGroupNumber) | async as allowed
          "
        >
          <h3>Choose product to add:</h3>

          <button
            *ngFor="let product of allowed?.data.products"
            (click)="addProductToBundle(allowed.entryGroupNumber, product)"
            class="d-block"
          >
            Add {{ product.name }}
          </button>
        </div>
      </div>
    </ng-container>
  </div>
</ng-container>

<ng-template let-ctx #saveForLaterBtn>
  <button
    *ngIf="selectiveCartEnabled"
    class="link cx-action-link cx-sfl-btn"
    [disabled]="ctx.loading"
    (click)="saveForLater(ctx.item)"
    type="button"
  >
    {{ 'saveForLaterItems.saveForLater' | cxTranslate }}
  </button>
</ng-template>
