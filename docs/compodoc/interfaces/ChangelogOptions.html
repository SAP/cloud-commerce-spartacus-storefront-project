<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>storefrontapp documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	      <link rel="stylesheet" href="../styles/style.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">storefrontapp documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content interface">
                   <div class="content-data">












<ol class="breadcrumb">
  <li>Interfaces</li>
  <li>ChangelogOptions</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>scripts/changelog.ts</code>
        </p>



        <section>
            <h3 id="index">Index</h3>
            <table class="table table-sm table-bordered index-table">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <h6><b>Properties</b></h6>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <ul class="index-list">
                                <li>
                                        <a href="#from">from</a>
                                </li>
                                <li>
                                            <span class="modifier">Optional</span>
                                        <a href="#githubToken">githubToken</a>
                                </li>
                                <li>
                                            <span class="modifier">Optional</span>
                                        <a href="#githubTokenFile">githubTokenFile</a>
                                </li>
                                <li>
                                            <span class="modifier">Optional</span>
                                        <a href="#library">library</a>
                                </li>
                                <li>
                                            <span class="modifier">Optional</span>
                                        <a href="#stdout">stdout</a>
                                </li>
                                <li>
                                            <span class="modifier">Optional</span>
                                        <a href="#to">to</a>
                                </li>
                            </ul>
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>



            <section>
                <h3 id="inputs">Properties</h3>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="from"></a>
                                        <span class="name"><b>from</b><a href="#from"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>from:     <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>    <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="githubToken"></a>
                                        <span class="name"><b>githubToken</b><a href="#githubToken"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>githubToken:     <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>    <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="col-md-4">
                                            <i>Optional</i>
                                        </td>
                                    </tr>




                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="githubTokenFile"></a>
                                        <span class="name"><b>githubTokenFile</b><a href="#githubTokenFile"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>githubTokenFile:     <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>    <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="col-md-4">
                                            <i>Optional</i>
                                        </td>
                                    </tr>




                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="library"></a>
                                        <span class="name"><b>library</b><a href="#library"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>library:     <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>    <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="col-md-4">
                                            <i>Optional</i>
                                        </td>
                                    </tr>




                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="stdout"></a>
                                        <span class="name"><b>stdout</b><a href="#stdout"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>stdout:     <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>    <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>

                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="col-md-4">
                                            <i>Optional</i>
                                        </td>
                                    </tr>




                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="to"></a>
                                        <span class="name"><b>to</b><a href="#to"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>to:     <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>    <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="col-md-4">
                                            <i>Optional</i>
                                        </td>
                                    </tr>




                        </tbody>
                    </table>
            </section>
    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { JsonObject, logging } from &#x27;@angular-devkit/core&#x27;;
import * as fs from &#x27;fs&#x27;;
import * as path from &#x27;path&#x27;;
import * as semver from &#x27;semver&#x27;;
import { packages } from &#x27;./packages&#x27;;
import * as ejs from &#x27;ejs&#x27;;
import * as program from &#x27;commander&#x27;;
import chalk from &#x27;chalk&#x27;;

const changelogTemplate &#x3D; ejs.compile(
  fs.readFileSync(&#x27;./scripts/templates/changelog.ejs&#x27;, &#x27;utf-8&#x27;),
  { client: true }
);

const conventionalCommitsParser &#x3D; require(&#x27;conventional-commits-parser&#x27;);
const gitRawCommits &#x3D; require(&#x27;git-raw-commits&#x27;);
const ghGot &#x3D; require(&#x27;gh-got&#x27;);
const through &#x3D; require(&#x27;through2&#x27;);

export interface ChangelogOptions {
  from: string;
  to?: string;
  githubTokenFile?: string;
  githubToken?: string;
  library?: string;
  stdout?: boolean;
}

export default function run(args: ChangelogOptions, logger: logging.Logger) {
  const commits: JsonObject[] &#x3D; [];
  let toSha: string | null &#x3D; null;

  const githubToken &#x3D; (
    args.githubToken ||
    (args.githubTokenFile &amp;&amp; fs.readFileSync(args.githubTokenFile, &#x27;utf-8&#x27;)) ||
    &#x27;&#x27;
  ).trim();

  return new Promise(resolve &#x3D;&gt; {
    (gitRawCommits({
      from: args.from,
      to: args.to || &#x27;HEAD&#x27;,
      format:
        &#x27;%B%n-hash-%n%H%n-gitTags-%n%D%n-committerDate-%n%ci%n-authorName-%n%aN%n&#x27;
    }) as NodeJS.ReadStream)
      .on(&#x27;error&#x27;, err &#x3D;&gt; {
        logger.fatal(&#x27;An error happened: &#x27; + err.message);
        process.exit(1);
      })
      .pipe(
        through((chunk: Buffer, _: string, callback: Function) &#x3D;&gt; {
          // Replace github URLs with &#x60;@XYZ#123&#x60;
          const commit &#x3D; chunk
            .toString(&#x27;utf-8&#x27;)
            .replace(/https?:\/\/github.com\/(.*?)\/issues\/(\d+)/g, &#x27;@$1#$2&#x27;);

          callback(undefined, new Buffer(commit));
        })
      )
      .pipe(
        conventionalCommitsParser({
          headerPattern: /^(\w*)(?:\(([^)]*)\))?: (.*)$/,
          headerCorrespondence: [&#x27;type&#x27;, &#x27;scope&#x27;, &#x27;subject&#x27;],
          noteKeywords: [&#x27;BREAKING CHANGE&#x27;],
          revertPattern: /^revert:\s([\s\S]*?)\s*This reverts commit (\w*)\./,
          revertCorrespondence: [&#x60;header&#x60;, &#x60;hash&#x60;]
        })
      )
      .pipe(
        through.obj((chunk: JsonObject, _: string, cb: Function) &#x3D;&gt; {
          try {
            const maybeTag &#x3D;
              chunk.gitTags &amp;&amp; (chunk.gitTags as string).match(/tag: (.*)/);
            const tags &#x3D; maybeTag &amp;&amp; maybeTag[1].split(/,/g);
            chunk[&#x27;tags&#x27;] &#x3D; tags;
            // tslint:disable-next-line:triple-equals
            if (tags &amp;&amp; tags.find(x &#x3D;&gt; x &#x3D;&#x3D; args.to)) {
              toSha &#x3D; chunk.hash as string;
            }

            commits.push(chunk);
            cb();
          } catch (err) {
            cb(err);
          }
        })
      )
      .on(&#x27;finish&#x27;, resolve);
  })
    .then(() &#x3D;&gt; {
      const markdown: string &#x3D; changelogTemplate({
        ...args,
        include: (x: string, v: {}) &#x3D;&gt;
          ejs.render(
            fs.readFileSync(
              path.join(&#x27;./scripts/templates&#x27;, &#x60;${x}.ejs&#x60;),
              &#x27;utf-8&#x27;
            ),
            v
          ),
        commits,
        packages
      });

      if (args.stdout || !githubToken) {
        console.log(markdown);
        process.exit(0);
      }

      // Check if we need to edit or create a new one.
      return ghGot(
        &#x27;repos/SAP/cloud-commerce-spartacus-storefront/releases&#x27;
      ).then((x: JsonObject) &#x3D;&gt; [x, markdown]);
    })
    .then(([body, markdown]) &#x3D;&gt; {
      const json &#x3D; body.body;
      // tslint:disable-next-line:triple-equals
      const maybeRelease &#x3D; json.find((x: JsonObject) &#x3D;&gt; x.tag_name &#x3D;&#x3D; args.to);
      const id &#x3D; maybeRelease ? &#x60;/${maybeRelease.id}&#x60; : &#x27;&#x27;;

      const semversion &#x3D; (args.to &amp;&amp; semver.parse(args.to)) || {
        prerelease: &#x27;&#x27;
      };

      return ghGot(
        &#x27;repos/SAP/cloud-commerce-spartacus-storefront/releases&#x27; + id,
        {
          body: {
            body: markdown,
            draft: true,
            name: args.to,
            prerelease: semversion.prerelease.length &gt; 0,
            tag_name: args.to,
            ...(toSha ? { target_commitish: toSha } : {})
          },
          token: githubToken
        }
      );
    });
}

program
  .option(&#x27;--from &lt;commit&gt;&#x27;, &#x27;From which commit/tag&#x27;)
  .option(&#x27;--to &lt;commit&gt;&#x27;, &#x27;To which commit/tag&#x27;)
  .option(&#x27;--verbose&#x27;, &#x27;Print output&#x27;)
  .option(&#x27;--githubToken &lt;token&gt;&#x27;, &#x27;Github token for release generation&#x27;)
  .option(&#x27;--tokenFile &lt;pathToFile&gt;&#x27;, &#x27;File with github token&#x27;)
  .option(&#x27;--lib &lt;lib&gt;&#x27;, &#x27;Changelog for passed library&#x27;)
  .parse(process.argv);

const config &#x3D; {
  from: program.from,
  to: program.to,
  stdout: program.verbose || false,
  githubToken: program.githubToken,
  githubTokenFile: program.tokenFile,
  library: program.lib
};

if (typeof config.from &#x3D;&#x3D;&#x3D; &#x27;undefined&#x27;) {
  console.error(chalk.red(&#x27;Missing --from option with start commit/tag&#x27;));
  process.exit(1);
} else if (typeof config.to &#x3D;&#x3D;&#x3D; &#x27;undefined&#x27;) {
  console.error(chalk.red(&#x27;Missing --to option with end commit/tag&#x27;));
  process.exit(1);
} else if (
  config.stdout &#x3D;&#x3D;&#x3D; false &amp;&amp;
  typeof config.githubToken &#x3D;&#x3D;&#x3D; &#x27;undefined&#x27; &amp;&amp;
  typeof config.githubTokenFile &#x3D;&#x3D;&#x3D; &#x27;undefined&#x27;
) {
  console.error(
    chalk.red(
      &#x27;Missing --githubToken/--tokenFile option with correct github token&#x27;
    )
  );
  process.exit(1);
} else if (typeof config.library &#x3D;&#x3D;&#x3D; &#x27;string&#x27;) {
  switch (config.library) {
    case &#x27;core&#x27;:
    case &#x27;@spartacus/core&#x27;:
      config.library &#x3D; &#x27;@spartacus/core&#x27;;
      break;
    case &#x27;storefrontlib&#x27;:
    case &#x27;@spartacus/storefrontlib&#x27;:
      config.library &#x3D; &#x27;@spartacus/storefrontlib&#x27;;
      break;
    case &#x27;styles&#x27;:
    case &#x27;@spartacus/styles&#x27;:
    case &#x27;storefrontstyles&#x27;:
      config.library &#x3D; &#x27;@spartacus/styles&#x27;;
      break;
    default:
      config.library &#x3D; undefined;
  }
}

run(config, new logging.NullLogger());
</code></pre>
    </div>
</div>






                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> result-matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'interface';
            var COMPODOC_CURRENT_PAGE_URL = 'ChangelogOptions.html';
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>
       <!-- Required to polyfill modern browsers as code is ES5 for IE... -->
       <script src="../js/libs/custom-elements-es5-adapter.js" charset="utf-8" defer></script>
       <script src="../js/menu-wc.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
