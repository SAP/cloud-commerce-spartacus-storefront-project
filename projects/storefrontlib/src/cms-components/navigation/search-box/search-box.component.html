<label class="searchbox" [class.dirty]="!!query.value">
  <input
    #query
    [placeholder]="'searchBox.placeholder' | cxTranslate"
    aria-label="search"
    (focus)="open($event)"
    (input)="search(query.value)"
    (blur)="close($event)"
    (keydown.escape)="close($event)"
    (keydown.enter)="launchSearchResult($event, query.value)"
  />

  <cx-icon
    [type]="iconTypes.RESET"
    aria-label="reset"
    (mousedown)="clear(query)"
    class="reset"
  ></cx-icon>

  <cx-icon
    [type]="iconTypes.SEARCH"
    aria-label="search"
    class="search"
  ></cx-icon>
</label>

<div *ngIf="(results$ | async) as result" class="results" (click)="close()">
  <!-- [class.hidden]="!searchBoxControl.value" -->
  <div
    *ngIf="result.message"
    class="message"
    [innerHTML]="result.message"
  ></div>

  <div class="suggestions" (mousedown)="disableClose()">
    <a
      *ngFor="let suggestion of result.suggestions"
      [innerHTML]="suggestion | cxHighlight: query.value"
      [routerLink]="
        {
          cxRoute: 'search',
          params: { query: suggestion }
        } | cxUrl
      "
    >
    </a>
  </div>

  <div class="products" (mousedown)="disableClose()" *ngIf="result.products">
    <a
      *ngFor="let product of result.products"
      [routerLink]="
        {
          cxRoute: 'product',
          params: product | stripHtml
        } | cxUrl
      "
    >
      <cx-media
        [container]="product.images?.PRIMARY"
        format="product"
        [alt]="product.summary"
      ></cx-media>
      <h4 class="name" [innerHtml]="product.name"></h4>
      <span class="price" [innerHTML]="product.price?.formattedValue"></span>
    </a>
  </div>
</div>
