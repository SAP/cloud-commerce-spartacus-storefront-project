<ng-container *ngIf="!!media">
  <picture *ngIf="media.srcset && !isLegacy; else legacyImgTmp">
    <source
      *ngFor="
        let source of media!.srcset! | cxMediaSources;
        trackBy: trackByMedia
      "
      [srcset]="source.srcset"
      [media]="source.media"
      [width]="SPIKE_extractDimensionsFromUrl(source.srcset).width"
      [height]="SPIKE_extractDimensionsFromUrl(source.srcset).height"
    />

    <img
      [loading]="SPIKE_loading"
      [alt]="media.alt"
      [title]="media.alt"
      [src]="media.src"
      [attr.role]="media.role"
      [attr.fetchpriority]="isLCP ? 'high' : 'auto'"
      (load)="loadHandler()"
      (error)="errorHandler()"
      [width]="SPIKE_extractDimensionsFromUrl(media.src).width"
      [height]="SPIKE_extractDimensionsFromUrl(media.src).height"
    />
  </picture>

  <ng-template #legacyImgTmp>
    <img
      *ngIf="media.src"
      [loading]="SPIKE_loading"
      [alt]="media.alt"
      [title]="media.alt"
      [src]="media.src"
      [srcset]="media?.srcset || media.src"
      [attr.role]="media.role"
      (load)="loadHandler()"
      (error)="errorHandler()"
      [width]="SPIKE_extractDimensionsFromUrl(media?.srcset || media.src).width"
      [height]="
        SPIKE_extractDimensionsFromUrl(media?.srcset || media.src).height
      "
    />
  </ng-template>
</ng-container>
